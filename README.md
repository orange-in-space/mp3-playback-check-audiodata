mp3再生環境チェックデータ＞＜

## これはなんでしょう？＞＜；


mp3の再生環境のチェック用オーディオデータです＞＜  
その環境で正しくmp3デコードできているかを簡単にチェックできます＞＜  

一言で説明すると「mp3を16bitでデコードすんな！＞＜」


## 注意事項

音が微妙に大きめの音声データです！＞＜  
再生時のプレイヤー等のボリュームは大きくしないでください！＞＜  
ボリュームが大きくなりすぎていると耳がデンジャーなだけでなく正しくチェックできません！＞＜  
「普段音楽とかを聴く時よりちょっと小さめかな？ 」くらいのボリュームで聞いてみてください＞＜  


## 各ファイル説明

### チェック用音声その1
mp3_check_01_TimesignalSound.mp3

時報っぽい音声データです＞＜  

正しく再生できる環境では全てサイン波＝よく時報で聞きそうな音として聞こえます＞＜  
正しくない環境ではなんか電子的っぽい音に聞こえます＞＜  

言葉で説明されても意味不明かもしれないので、
必ず正しく再生されるサンプルデータ  
mp3_check_01_TimesignalSound_CorrectPlaybackSample.mp3  

と、  
正しくない環境で再生された時の音をシミュレートしたデータ  
mp3_check_01_TimesignalSound_IncorrectPlaybackSample.mp3  


も添付しました！＞＜  
どっちと同じ感じに聞こえるかで、正しいかどうか判別できます！！！＞＜  


### チェック用音声その2
mp3_check_02_env.mp3

だんだん音が大きくなってまた小さくなる音声データです＞＜  
正しい環境ではずっと同じ音色に聞こえて、
正しくない環境では10秒付近~20秒付近にかけて、違う音（なんか電子的っぽい音）が混じってくるように聞こえます＞＜  


## 結果「正しくない環境」だったっぽいんだけどどうすれば・・・

### 聴く人（プレイヤーを使う側の人）の場合
「32bit float形式で再生する」「floatで再生」みたいな感じのオプションがあるプレイヤーであれば、それを有効にしてみましょう＞＜  
デコーダがプラグインになっていてmp3デコーダプラグインが複数あるものであれば、他のデコーダに変えたらうまくいくかもしれません＞＜  

WindowsでDirectShowコーデックで再生する仕組みのプレイヤー
（プレイヤーにmp3デコーダーが搭載されてなくて、Windowsの1機能であるDirectShowに丸投げしてるタイプ）を使用していて、
コーデックパックを使用している場合は、そのコーデックパックの設定項目で32bitデコードに設定したり、
優先するコーデックを変更すると直る場合もあります＞＜  
（筆者の環境の場合ではffdshowを使用していて、MP3のデコードをlibavcodecに設定したら32bitでデコードできるようになりました＞＜）

mp3ファイル側で対策する方法もあります＞＜  
mp3gain等のmp3の音量を非破壊で調整できるソフトウェアで、最大音量が1.0を越えないようにすれば、
問題なく再生できます＞＜  
ただし、ちゃんと一発でデータ的に正しい音量に調整できるアプリってあんまり無い気が？＞＜  
（音の大きさのみで考えてて、このテストファイルであぶりだされる問題まで考えて無いっぽさ・・・＞＜）  

「ていうか、いま使ってるプレイヤーは投げ捨ててもいいんだけど！？ どれなら正しく再生できるの？」  
という場合は、例えば「foobar2000」や「VLC media player」や「KbMedia Player」の最近のバージョンは、
特に設定を変えなくても正しく再生できるっぽいです＞＜（一応このテスト音声で試してみてね！＞＜）  

### プレイヤーを作る開発者の場合
最終的にほしいデータが16bitPCMであっても16bitでデコードしない＞＜  
ライブラリやコーデックはfloat（あるいは24bit intのもあるらしい）でデコードできるものを使用して、
音量調整してから16bitに落としてください＞＜ mp3は16bitでそのままデコードできるようなフォーマットではありません＞＜

### そもそも何をチェックしているのか？＞＜
雑に説明すると、mp3は最大値という概念がないので、浮動小数点PCMで言う所の-1.0～1.0を超えるデータを記録できてしまいます＞＜  
実際にそこらにあるmp3ファイルで超えてるものもよくありますし、Amazon mp3で売ってるデータでさえ一部（大半？＞＜；）超えてます＞＜  

これを16bitで1.0を最大値とみなしてデコードしてしまうと超えてる部分が盛大にクリッピングします＞＜  
結果、全く違う波形として再生されてしまい本来と違う音として再生されます＞＜  

困った事に世の中のmp3プレイヤー（デコーダー）のわりと少なくないものが1.0を最大とみなしてデコードしてしまいます＞＜  
（クリッピングして壊れた状態のデータを作ってから、さらにそこから音量を調節する（下げる）という誤った実装になってる）  
例えば「WindowsMediaPlayer 12」とかWindows版「Winamp」なんかもその方式でデコードします＞＜  
16bitデコードと32bit floatデコードが選べるプレイヤーの多くも、16bitデコードの設定のままでは正しくない方式でデコードされちゃいます＞＜

